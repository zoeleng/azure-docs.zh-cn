---
title: 标识模型
titleSuffix: An Azure Communication Services concept
description: 了解标识和访问令牌
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: f172bfcb6e4f11520eb9082052968626efe6fecb
ms.sourcegitcommit: 8e7316bd4c4991de62ea485adca30065e5b86c67
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/17/2020
ms.locfileid: "94651237"
---
# <a name="identity-model"></a>标识模型

Azure 通信服务是标识无关的服务。 此设计具有多项优势：

- 重用标识管理系统中的现有标识
- 为集成方案提供灵活性
- 在 Azure 通信服务中使你的标识保持私密

您将不会在系统中复制信息，而是保留业务案例所需的映射关系。 例如，可以映射标识1:1，1： N，N：1，N:M。 外部标识符（如电话号码、用户、设备、应用程序和 Guid）不能用于 Azure 通信服务中的标识。 为 Azure 通信服务标识生成的访问令牌用于访问聊天或调用等基元。

## <a name="identity"></a>标识

可以使用 Azure 通信服务管理库来创建标识。 标识用作会话中的标识符。 它用于创建访问令牌。 相同的标识可能会在多个设备之间加入多个会话。 一个标识可以同时拥有多个活动的访问令牌。 

删除标识、资源或订阅会使其所有访问令牌失效。 此操作还会删除为标识存储的所有数据。 已删除的标识无法创建新的访问令牌或访问以前存储的数据 (例如，聊天消息) 。 

你不需要为你拥有的标识数量收费。 相反，您需要对基元的使用进行收费。 标识的数量不必限制将应用程序的标识映射到 Azure 通信服务标识的方式。 

利用映射自由，就成为隐私责任。 如果用户想要从系统中删除，则需要删除与该用户相关联的所有标识。

Azure 通信服务不为匿名用户提供特殊身份。 它不会保留用户和标识之间的映射，也不能确定某个标识是否是匿名的。 你可以设计标识概念以满足你的需求。 建议为每个应用程序上的每个匿名用户创建新的标识。 

具有有效访问令牌的任何人都可以访问当前标识内容。 例如，用户可以访问他们发送的聊天消息。 仅限访问令牌中的作用域的访问权限。 有关详细信息，请参阅本文中的 [访问令牌](#access-tokens) 部分。

### <a name="identity-mapping"></a>标识映射

Azure 通信服务不会复制 Azure 标识管理系统的功能。 它不会为客户提供使用特定于客户的标识的方式。 例如，客户不能使用电话号码或电子邮件地址。 相反，Azure 通信服务提供唯一的标识符。 可以将这些唯一标识符分配给应用程序的标识。 Azure 通信服务不存储任何类型的信息，这些信息可能会泄漏用户的真实身份。

若要避免系统中的信息重复，请计划如何将用户从标识域映射到 Azure 通信服务标识。 可以遵循任意一种模式。 例如，你可以使用1:1，1： N、N：1或 M:N。 确定单个用户是映射到单个标识还是映射到多个标识。 

创建新标识后，将其映射存储到应用程序的用户或用户。 由于标识要求使用访问令牌来使用基元，因此，应用程序的用户或用户需要知道标识。

如果使用关系数据库存储用户信息，则可以基于映射方案调整设计。 对于映射1:1 或 N：1的方案，可能需要向表中添加一 `CommunicationServicesId` 列来存储 Azure 通信服务标识。 在使用关系1： N 或 N:M 的方案中，可以考虑在关系数据库中创建一个单独的表。

## <a name="access-tokens"></a>访问令牌

访问令牌是 (JWT) 的 JSON Web 令牌，可用于获取对 Azure 通信服务基元的访问权限。 颁发的访问令牌具有完整性保护。 也就是说，其声明在颁发后不能更改。 因此，手动更改标识、过期或范围等属性将使访问令牌失效。 如果将基元用于无效的标记，则会拒绝对基元的访问。 

访问令牌的属性为：
* 标识.
* Expiration。
* 作用.

访问令牌始终有效24小时。 过期后，访问令牌会失效，不能用于访问任何基元。 

标识需要从服务器端服务请求新的访问令牌的方式。 *Scope* 参数定义可使用的一组非空基元。 Azure 通信服务支持访问令牌的以下作用域。

|名称|说明|
|---|---|
|聊天|  授予加入聊天的能力|
|VoIP|  授予调用标识和电话号码的能力|


若要在过期时间之前撤销访问令牌，请使用 Azure Communication Services 管理库。 令牌吊销不是即时的。 传播最多需要15分钟。 删除标识、资源或订阅会撤销所有访问令牌。 

如果要删除用户访问特定功能的能力，请撤消所有访问令牌。 然后颁发一个新的访问令牌，该令牌具有更有限的作用域集。

在 Azure 通信服务中，访问密钥的轮替会吊销使用以前的访问密钥创建的所有活动访问令牌。 所有标识都将失去对 Azure 通信服务的访问权限，并且必须颁发新的访问令牌。 

建议在服务器端服务而不是客户端的应用程序中颁发访问令牌。 原因是发出要求使用访问密钥或托管标识。 出于安全原因，不建议将访问密钥与客户端应用程序共享。 

客户端应用程序应使用可以对客户端进行身份验证的受信任的服务终结点。 终结点应代表它们发出访问令牌。 有关详细信息，请参阅 [客户端和服务器体系结构](./client-and-server-architecture.md)。

如果将访问令牌缓存到后备存储，建议使用加密。 访问令牌是敏感数据。 如果不受保护，则可将其用于恶意活动。 拥有访问令牌的用户可以启动 SDK 并访问 API。 仅根据访问令牌具有的作用域限制可访问的 API。 建议颁发仅具有所需作用域的访问令牌。

## <a name="next-steps"></a>后续步骤

* 有关访问令牌管理的简介，请参阅 [创建和管理访问令牌](https://docs.microsoft.com/azure/communication-services/quickstarts/access-tokens)。
* 有关身份验证的简介，请参阅对 [Azure 通信服务进行身份验证](https://docs.microsoft.com/azure/communication-services/concepts/authentication)。
* 有关数据驻留和隐私的简介，请参阅 [区域可用性和数据驻留](https://docs.microsoft.com/azure/communication-services/concepts/privacy)。
